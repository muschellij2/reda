<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Introduction to reda through Examples • reda</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Introduction to reda through Examples">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">reda</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.5.1.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/reda-Recur.html">Introduction to Formula Response Function Recur()</a>
    </li>
    <li>
      <a href="../articles/reda-intro.html">Introduction to reda through Examples</a>
    </li>
    <li>
      <a href="../articles/reda-simulate.html">Simulate Survival and Recurrent Event Data with reda</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/wenjie2wang/reda">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="reda-intro_files/header-attrs-2.1/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Introduction to reda through Examples</h1>
                        <h4 class="author">Wenjie Wang</h4>
            
            <h4 class="date">2020-03-25</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/wenjie2wang/reda/blob/master/vignettes/reda-intro.Rmd"><code>vignettes/reda-intro.Rmd</code></a></small>
      <div class="hidden name"><code>reda-intro.Rmd</code></div>

    </div>

    
    
<p>In this vignette, we introduce how to explore recurrent event data by mean cumulative function, and modeling the event counts of interest by gamma frailty model with the <strong>reda</strong> package through examples. Most functions in the package are S4 methods that produce S4 class objects. The details of function syntax and the produced objects are available in the package manual, which will thus not be covered in this vignette.</p>
<div id="introduction" class="section level1">
<h1 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h1>
<div id="simuDat" class="section level2">
<h2 class="hasAnchor">
<a href="#simuDat" class="anchor"></a>Simulated recurrent event data</h2>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(reda)</span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="kw"><a href="https://rdrr.io/r/utils/packageDescription.html">packageVersion</a></span>(<span class="st">"reda"</span>)</span></code></pre></div>
<pre><code>## [1] '0.5.1.9000'</code></pre>
<p>First of all, the sample recurrent event data we are going to use in the following examples is called <code>simuDat</code>, which contains totally 500 observations of 6 variables.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a><span class="kw"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(simuDat)</span></code></pre></div>
<pre><code>##   ID time event group    x1 gender
## 1  1    1     1 Contr -1.93 female
## 2  1   22     1 Contr -1.93 female
## 3  1   23     1 Contr -1.93 female
## 4  1   57     1 Contr -1.93 female
## 5  1  112     0 Contr -1.93 female
## 6  2  140     0 Treat -0.11 female</code></pre>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a><span class="kw"><a href="https://rdrr.io/r/utils/str.html">str</a></span>(simuDat)</span></code></pre></div>
<pre><code>## 'data.frame':    500 obs. of  6 variables:
##  $ ID    : num  1 1 1 1 1 2 3 3 4 4 ...
##  $ time  : num  1 22 23 57 112 140 40 168 14 112 ...
##  $ event : int  1 1 1 1 0 0 1 0 1 0 ...
##  $ group : Factor w/ 2 levels "Contr","Treat": 1 1 1 1 1 2 1 1 1 1 ...
##  $ x1    : num  -1.93 -1.93 -1.93 -1.93 -1.93 -0.11 0.2 0.2 -0.43 -0.43 ...
##  $ gender: Factor w/ 2 levels "female","male": 1 1 1 1 1 1 1 1 1 1 ...</code></pre>
<p>where</p>
<ul>
<li>
<code>ID</code>: Subjects identification (ID).</li>
<li>
<code>time</code>: Event or censoring time.</li>
<li>
<code>event</code>: Event indicator, 1 = event; 0 = censored.</li>
<li>
<code>group</code>: Treatment group indicator.</li>
<li>
<code>x1</code>: Continuous variable.</li>
<li>
<code>gender</code>: Gender of subjects.</li>
</ul>
<p>The dataset was simulated by thinning method <span class="citation">(Lewis and Shedler 1979)</span> and further processed for a better demonstration purpose. (Note that <strong>reda</strong> also provides functions for simulating survival data, and recurrent event data. See <code><a href="../articles/reda-simulate.html">vignette("reda-simulate")</a></code> for details.)</p>
</div>
<div id="data-checking" class="section level2">
<h2 class="hasAnchor">
<a href="#data-checking" class="anchor"></a>Data checking</h2>
<p>The process’s ID, event times, event indicators or costs, time origins, and possible terminal events of the follow-up is specified in the function <code><a href="../reference/Recur.html">Recur()</a></code>, which serves as the formula response and contains considerate data checking procedures for recurrent event data. See <code><a href="../articles/reda-Recur.html">vignette("reda-Recur")</a></code> for details.</p>
</div>
</div>
<div id="exploratory-analysis" class="section level1">
<h1 class="hasAnchor">
<a href="#exploratory-analysis" class="anchor"></a>Exploratory analysis</h1>
<div id="mcf-formula" class="section level2">
<h2 class="hasAnchor">
<a href="#mcf-formula" class="anchor"></a>Nonparametric Mean Cumulative Function Estimates</h2>
<p>The nonparametric mean cumulative function (MCF) estimates are widely utilized in exploring the trend of recurrent event data. MCF is also called cumulative mean function (CMF) in literature <span class="citation">(see e.g., Lawless and Nadeau 1995)</span>. Let <span class="math inline">\(N_i(t)\)</span> denote the number of events that occurred up to time <span class="math inline">\(t\)</span> of process <span class="math inline">\(i\)</span>. The MCF of <span class="math inline">\(N_i(t)\)</span> denoted by <span class="math inline">\(M_i(t)\)</span>, is defined as follows: <span class="math display">\[M_i(t)=\mathbb{E}\{N_i(t)\}.\]</span> For <span class="math inline">\(k\)</span> independent processes having the same MCF, the Nelson-Aalen Estimator <span class="citation">(Nelson 2003)</span> is often used, which is defined as follows: <span class="math display">\[ \hat{M}(t) = \int_0^t \frac{dN(s)}{\delta(s)}, \]</span> where <span class="math inline">\(dN(s)=\sum_{i=1}^k dN_i(s)\)</span>, <span class="math inline">\(dN_i(s)\)</span> is the jump size of process <span class="math inline">\(i\)</span> at time <span class="math inline">\(s\)</span>, <span class="math inline">\(\delta(s) = \sum_{i=1}^k \delta_i(s)\)</span>, <span class="math inline">\(\delta_i(s)\)</span> is the at-risk indicator of process <span class="math inline">\(i\)</span> at time <span class="math inline">\(s\)</span>. One variant is called the cumulative sample mean (CSM) function introduced by <span class="citation">Cook and Lawless (2007)</span>, which assumes that <span class="math inline">\(\delta_i(s) = 1\)</span> for <span class="math inline">\(s \ge 0\)</span>.</p>
<p>The nonparametric estimate of MCF at each time point does not assume any particular underlying model. The variance estimates at each time point can be computed by the Lawless and Nadeau method <span class="citation">(Lawless and Nadeau 1995)</span>, Poisson process method, the bootstrap method <span class="citation">(Efron 1979)</span> with subjects as resampling units. For CSM, the cumulative sample variance (CSV) method can be used instead. The approximate confidence intervals are provided as well, which are constructed based on the asymptotic normality of the MCF estimates itself or logarithm of the MCF estimates.</p>
<p>The function <code><a href="../reference/mcf.html">mcf()</a></code> is a generic function for the MCF estimates from a sample data or a fitted gamma frailty model (as demonstrated later). If a formula with <code><a href="../reference/Recur.html">Recur()</a></code> as formula response is specified in function <code><a href="../reference/mcf.html">mcf()</a></code>, the formula method for estimating the sample MCF will be called. The covariate specified at the right hand side of the formula should be either <code>1</code> or any “linear” combination of factor variables in the data. The former computes the overall sample MCF. The latter computes the sample MCF for each level of the combination of the factor variable(s) specified, respectively.</p>
<p>The valve-seat dataset in <span class="citation">Nelson (1995)</span> and the simulated sample data are used for demonstration as follows:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a><span class="co">## Example 1. valve-seat data</span></span>
<span id="cb7-2"><a href="#cb7-2"></a>valveMcf0 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/mcf.html">mcf</a></span>(<span class="kw"><a href="../reference/Recur.html">Recur</a></span>(Days, ID, No.) <span class="op">~</span><span class="st"> </span><span class="dv">1</span>, <span class="dt">data =</span> valveSeats)</span>
<span id="cb7-3"><a href="#cb7-3"></a></span>
<span id="cb7-4"><a href="#cb7-4"></a><span class="co">## Example 2. the simulated data</span></span>
<span id="cb7-5"><a href="#cb7-5"></a>simuMcf &lt;-<span class="st"> </span><span class="kw"><a href="../reference/mcf.html">mcf</a></span>(<span class="kw"><a href="../reference/Recur.html">Recur</a></span>(time, ID, event) <span class="op">~</span><span class="st"> </span>group <span class="op">+</span><span class="st"> </span>gender,</span>
<span id="cb7-6"><a href="#cb7-6"></a>               <span class="dt">data =</span> simuDat, <span class="dt">subset =</span> ID <span class="op">%in%</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/seq.html">seq_len</a></span>(<span class="dv">50</span>))</span></code></pre></div>
<p>After estimation, we may plot the sample MCF by function <code><a href="https://rdrr.io/r/graphics/plot.html">plot()</a></code>, which returns a <code>ggplot</code> object so that the plot produced can be easily further customized by <strong>ggplot2</strong>. The <code>legendname</code> and <code>legendLevels</code> can be specified to easily customize the legend in the plot. Two examples are given as follows:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a><span class="co">## overall sample MCF for valve-seat data in Nelson (1995)</span></span>
<span id="cb8-2"><a href="#cb8-2"></a><span class="kw"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(valveMcf0, <span class="dt">conf.int =</span> <span class="ot">TRUE</span>, <span class="dt">mark.time =</span> <span class="ot">TRUE</span>, <span class="dt">addOrigin =</span> <span class="ot">TRUE</span>, <span class="dt">col =</span> <span class="dv">2</span>) <span class="op">+</span></span>
<span id="cb8-3"><a href="#cb8-3"></a><span class="st">    </span>ggplot2<span class="op">::</span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span>(<span class="st">"Days"</span>) <span class="op">+</span><span class="st"> </span>ggplot2<span class="op">::</span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span>()</span></code></pre></div>
<p><img src="reda-intro_files/figure-html/plot-sampleMcf-1.png" width="672"></p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a><span class="co">## sample MCF for different groups (the default theme)</span></span>
<span id="cb9-2"><a href="#cb9-2"></a><span class="kw"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(simuMcf, <span class="dt">conf.int =</span> <span class="ot">TRUE</span>, <span class="dt">lty =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">4</span>, <span class="dt">legendName =</span> <span class="st">"Treatment &amp; Gender"</span>)</span></code></pre></div>
<p><img src="reda-intro_files/figure-html/plot-sampleMcf-2.png" width="672"></p>
<p>Note that in the first plot, the censoring times was marked on the step curve by specifying <code>mark.time = TRUE</code> and the time origins was included in the curve by specifying <code>addOrigin = TRUE</code>. In addition, the type and color of the line can be specified through <code>lty</code> and <code>col</code>, respectively.</p>
<p>As for the variance estimates, the Poisson process method assumes that the underlying counting process is a Poisson process and may underestimate the variance if the assumption cannot be justified. While, the Lawless and Nadeau method is more robust to departures from the Poisson process assumption. The nonparametric bootstrap method can be considered as well if an extra computational burden is not of concern. We may perform a quick comparison among the standard error estimates and the confidence intervals from these methods for the valve seats data as follows:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1"></a><span class="co">## Poisson process method</span></span>
<span id="cb10-2"><a href="#cb10-2"></a>valveMcf1 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/mcf.html">mcf</a></span>(<span class="kw"><a href="../reference/Recur.html">Recur</a></span>(Days, ID, No.) <span class="op">~</span><span class="st"> </span><span class="dv">1</span>, valveSeats, <span class="dt">variance =</span> <span class="st">"Poisson"</span>)</span>
<span id="cb10-3"><a href="#cb10-3"></a></span>
<span id="cb10-4"><a href="#cb10-4"></a><span class="co">## bootstrap method (with 1,000 bootstrap samples)</span></span>
<span id="cb10-5"><a href="#cb10-5"></a><span class="kw"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span>(<span class="dv">123</span>)</span>
<span id="cb10-6"><a href="#cb10-6"></a>valveMcf2 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/mcf.html">mcf</a></span>(<span class="kw"><a href="../reference/Recur.html">Recur</a></span>(Days, ID, No.) <span class="op">~</span><span class="st"> </span><span class="dv">1</span>, valveSeats,</span>
<span id="cb10-7"><a href="#cb10-7"></a>                 <span class="dt">variance =</span> <span class="st">"bootstrap"</span>, <span class="dt">control =</span> <span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="dt">B =</span> <span class="fl">1e3</span>))</span>
<span id="cb10-8"><a href="#cb10-8"></a></span>
<span id="cb10-9"><a href="#cb10-9"></a><span class="co">## comparing the standard error estimates</span></span>
<span id="cb10-10"><a href="#cb10-10"></a><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(ggplot2)</span>
<span id="cb10-11"><a href="#cb10-11"></a>ciDat &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span>(valveMcf0<span class="op">@</span>MCF, <span class="dt">Method =</span> <span class="st">"Lawless &amp; Nadeau"</span>),</span>
<span id="cb10-12"><a href="#cb10-12"></a>               <span class="kw"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span>(valveMcf1<span class="op">@</span>MCF, <span class="dt">Method =</span> <span class="st">"Poisson"</span>),</span>
<span id="cb10-13"><a href="#cb10-13"></a>               <span class="kw"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span>(valveMcf2<span class="op">@</span>MCF, <span class="dt">Method =</span> <span class="st">"Bootstrap"</span>))</span>
<span id="cb10-14"><a href="#cb10-14"></a><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(ciDat, <span class="kw"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="dt">x =</span> time, <span class="dt">y =</span> se)) <span class="op">+</span></span>
<span id="cb10-15"><a href="#cb10-15"></a><span class="st">    </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_step</a></span>(<span class="kw"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="dt">color =</span> Method, <span class="dt">linetype =</span> Method)) <span class="op">+</span></span>
<span id="cb10-16"><a href="#cb10-16"></a><span class="st">    </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span>(<span class="st">"Days"</span>) <span class="op">+</span><span class="st"> </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span>(<span class="st">"SE estimates"</span>) <span class="op">+</span><span class="st"> </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span>()</span></code></pre></div>
<p><img src="reda-intro_files/figure-html/plot-mcfSE-1.png" width="672"></p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1"></a><span class="co">## comparing the confidence intervals</span></span>
<span id="cb11-2"><a href="#cb11-2"></a><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(ciDat, <span class="kw"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="dt">x =</span> time)) <span class="op">+</span></span>
<span id="cb11-3"><a href="#cb11-3"></a><span class="st">    </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_step</a></span>(<span class="kw"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="dt">y =</span> MCF), <span class="dt">color =</span> <span class="st">"grey"</span>) <span class="op">+</span></span>
<span id="cb11-4"><a href="#cb11-4"></a><span class="st">    </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_step</a></span>(<span class="kw"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="dt">y =</span> lower, <span class="dt">color =</span> Method, <span class="dt">linetype =</span> Method)) <span class="op">+</span></span>
<span id="cb11-5"><a href="#cb11-5"></a><span class="st">    </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_step</a></span>(<span class="kw"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="dt">y =</span> upper, <span class="dt">color =</span> Method, <span class="dt">linetype =</span> Method)) <span class="op">+</span></span>
<span id="cb11-6"><a href="#cb11-6"></a><span class="st">    </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span>(<span class="st">"Days"</span>) <span class="op">+</span><span class="st"> </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span>(<span class="st">"Confidence intervals"</span>) <span class="op">+</span><span class="st"> </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span>()</span></code></pre></div>
<p><img src="reda-intro_files/figure-html/plot-mcfCI-1.png" width="672"></p>
<p>From the comparison, we may find that the SE estimates and the confidence intervals from the Lawless and Nadaeu method and the bootstrap method have a good agreement, while the Poisson process method gives slightly smaller SE estimates and a narrower confidence band. In practice, the Lawless and Nadeau method is suggested if it is hard to justify the Poisson process assumption.</p>
</div>
<div id="mcfDiff" class="section level2">
<h2 class="hasAnchor">
<a href="#mcfDiff" class="anchor"></a>Comparing two-sample MCFs</h2>
<p>The function <code><a href="../reference/mcfDiff.html">mcfDiff.test()</a></code> is an implementation of the pseudo-score tests for comparing two-sample MCFs proposed by <span class="citation">Cook, Lawless, and Nadeau (1996)</span>, while the function <code><a href="../reference/mcfDiff.html">mcfDiff()</a></code> gives the difference estimates and wraps the pseudo-score testing results from <code><a href="../reference/mcfDiff.html">mcfDiff.test()</a></code> (by default).</p>
<p>Suppose we are interested in comparing the two-sample MCFs between the treatment and control group in the simulated data. We may simply feed the <code>mcf.formula</code> object returned from the function <code><a href="../reference/mcf.html">mcf()</a></code> to function <code><a href="../reference/mcfDiff.html">mcfDiff()</a></code> as follows:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1"></a><span class="co">## one sample MCF object of two groups</span></span>
<span id="cb12-2"><a href="#cb12-2"></a>mcf0 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/mcf.html">mcf</a></span>(<span class="kw"><a href="../reference/Recur.html">Recur</a></span>(time, ID, event) <span class="op">~</span><span class="st"> </span>group, <span class="dt">data =</span> simuDat)</span>
<span id="cb12-3"><a href="#cb12-3"></a>(mcf_diff0 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/mcfDiff.html">mcfDiff</a></span>(mcf0))</span></code></pre></div>
<pre><code>## Call: 
## mcfDiff(mcf1 = mcf0)
## 
## Two-Sample Pseudo-Score Tests:
##                 Statistic Variance    Chisq DF Pr(&gt;Chisq)   
## Constant Weight   52.5855 670.1014   4.1266  1   0.042214 * 
## Linear Weight     35.7687 158.9869   8.0472  1   0.004557 **
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Variance Estimator: robust</code></pre>
<p>Then what if the covariate <code>group</code> contains more than two levels? In that case, we may compute the sample MCF for each group, respectively, and feed both of the generated <code>mcf.formula</code> objects to <code>mcfDiff</code> as the first two arguments. Alternatively, an intuitive <code><a href="https://rdrr.io/r/base/Arithmetic.html">-</a></code> method is available for comparing the difference between two <code>mcf.formual</code> objects, <code>mcf1</code> and <code>mcf2</code>, returned from the <code>mcf</code> formula method, which means that the function call <code>mcf1 - mcf2</code> is equivalent to <code><a href="../reference/mcfDiff.html">mcfDiff(mcf1, mcf2)</a></code>. A simple example is given below.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1"></a><span class="co">## explicitly ask for the difference of two sample MCF</span></span>
<span id="cb14-2"><a href="#cb14-2"></a>mcf1 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/mcf.html">mcf</a></span>(<span class="kw"><a href="../reference/Recur.html">Recur</a></span>(time, ID, event) <span class="op">~</span><span class="st"> </span><span class="dv">1</span>, simuDat, group <span class="op">%in%</span><span class="st"> "Contr"</span>)</span>
<span id="cb14-3"><a href="#cb14-3"></a>mcf2 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/mcf.html">mcf</a></span>(<span class="kw"><a href="../reference/Recur.html">Recur</a></span>(time, ID, event) <span class="op">~</span><span class="st"> </span><span class="dv">1</span>, simuDat, group <span class="op">%in%</span><span class="st"> "Treat"</span>)</span>
<span id="cb14-4"><a href="#cb14-4"></a>mcf1 <span class="op">-</span><span class="st"> </span>mcf2</span></code></pre></div>
<pre><code>## Call: 
## mcfDiff(mcf1 = mcf1, mcf2 = mcf2)
## 
## Two-Sample Pseudo-Score Tests:
##                 Statistic Variance    Chisq DF Pr(&gt;Chisq)   
## Constant Weight   52.5855 670.1014   4.1266  1   0.042214 * 
## Linear Weight     35.7687 158.9869   8.0472  1   0.004557 **
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Variance Estimator: robust</code></pre>
<p>Similarly, a <code><a href="https://rdrr.io/r/graphics/plot.html">plot()</a></code> method based on <strong>ggplot2</strong> is available for visual comparison.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1"></a><span class="kw"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(mcf_diff0)</span></code></pre></div>
<p><img src="reda-intro_files/figure-html/plot-mcfDiff-1.png" width="672"></p>
</div>
</div>
<div id="rateReg" class="section level1">
<h1 class="hasAnchor">
<a href="#rateReg" class="anchor"></a>Gamma frailty model</h1>
<div id="constFit" class="section level2">
<h2 class="hasAnchor">
<a href="#constFit" class="anchor"></a>Model with constant rate function</h2>
<p>The default model when argument <code>df</code>, <code>knots</code>, and <code>degree</code> are not specified is gamma frailty model with (one piece) constant rate function, which is equivalent to negative binomial regression with the same shape and rate parameter in the gamma prior.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1"></a>(constFit &lt;-<span class="st"> </span><span class="kw"><a href="../reference/rateReg.html">rateReg</a></span>(<span class="kw"><a href="../reference/Recur.html">Recur</a></span>(time, ID, event) <span class="op">~</span><span class="st"> </span>group <span class="op">+</span><span class="st"> </span>x1, <span class="dt">data =</span> simuDat))</span></code></pre></div>
<pre><code>## Call: 
## rateReg(formula = Recur(time, ID, event) ~ group + x1, data = simuDat)
## 
## Coefficients of covariates: 
## groupTreat         x1 
## -0.6072889  0.3257505 
## 
## Frailty parameter:  0.5874622 
## 
## Boundary knots: 
## 0, 168
## 
## Coefficients of pieces:
##  B-spline1 
## 0.03041865</code></pre>
<p>The function <code><a href="../reference/rateReg.html">rateReg()</a></code> returns <code>rateReg</code> object, which can be printed out by calling the object. (Internally, <code>show()</code> method for <code>rateReg</code> object is called.)</p>
</div>
<div id="piecesFit" class="section level2">
<h2 class="hasAnchor">
<a href="#piecesFit" class="anchor"></a>Model with piecewise constant rate function</h2>
<p>When argument <code>df</code> or <code>knots</code> (at least one internal knot) is specified, the model becomes gamma frailty model with piecewise constant rate function or so-called HEART model <span class="citation">(Fu, Luo, and Qu 2016)</span> if argument degree is specified to be zero as default.</p>
<p>We may specify <code>df</code> and leave <code>knots</code> and <code>degree</code> as default. Then piecewise constant rate function will be applied and the number of pieces will equal <code>df</code>. The internal knots will be automatically specified at suitable quantiles of the covariate representing event and censoring time.</p>
<p>For example, two pieces’ constant rate function can be simply specified by setting <code>df = 2</code>. The internal knot will be the median time of all the event and censoring time. Also, we can fit the models on the first 50 subjects by specifying argument <code>subset</code>.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1"></a><span class="co"># two pieces' constant rate function</span></span>
<span id="cb19-2"><a href="#cb19-2"></a>(twoPiecesFit &lt;-<span class="st"> </span><span class="kw"><a href="../reference/rateReg.html">rateReg</a></span>(<span class="kw"><a href="../reference/Recur.html">Recur</a></span>(time, ID, event) <span class="op">~</span><span class="st"> </span>group <span class="op">+</span><span class="st"> </span>x1, <span class="dt">df =</span> <span class="dv">2</span>,</span>
<span id="cb19-3"><a href="#cb19-3"></a>                         <span class="dt">data =</span> simuDat, <span class="dt">subset =</span> ID <span class="op">%in%</span><span class="st"> </span><span class="dv">1</span><span class="op">:</span><span class="dv">50</span>))</span></code></pre></div>
<pre><code>## Call: 
## rateReg(formula = Recur(time, ID, event) ~ group + x1, data = simuDat, 
##     subset = ID %in% 1:50, df = 2)
## 
## Coefficients of covariates: 
## groupTreat         x1 
## -0.7883880  0.3387935 
## 
## Frailty parameter:  0.6918456 
## 
## Internal knots: 
## 102
## 
## Boundary knots: 
## 0, 168
## 
## Coefficients of pieces:
##  B-spline1  B-spline2 
## 0.03396500 0.04889013</code></pre>
<p>In the example shown above, the internal knots is set automatically to be 102 and the baseline rate function is two pieces’ constant.</p>
<p>If internal <code>knots</code> are specified explicitly, the <code>df</code> will be neglected even if it is specified. An example of model with six pieces’ constant rate function is given as follows:</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1"></a>(piecesFit &lt;-<span class="st"> </span><span class="kw"><a href="../reference/rateReg.html">rateReg</a></span>(<span class="kw"><a href="../reference/Recur.html">Recur</a></span>(time, ID, event) <span class="op">~</span><span class="st"> </span>group <span class="op">+</span><span class="st"> </span>x1, <span class="dt">data =</span> simuDat,</span>
<span id="cb21-2"><a href="#cb21-2"></a>                      <span class="dt">knots =</span> <span class="kw"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="dt">from =</span> <span class="dv">28</span>, <span class="dt">to =</span> <span class="dv">140</span>, <span class="dt">by =</span> <span class="dv">28</span>)))</span></code></pre></div>
<pre><code>## Call: 
## rateReg(formula = Recur(time, ID, event) ~ group + x1, data = simuDat, 
##     knots = seq(from = 28, to = 140, by = 28))
## 
## Coefficients of covariates: 
## groupTreat         x1 
## -0.6382015  0.3062607 
## 
## Frailty parameter:  0.5865717 
## 
## Internal knots: 
## 28, 56, 84, 112, 140
## 
## Boundary knots: 
## 0, 168
## 
## Coefficients of pieces:
##  B-spline1  B-spline2  B-spline3  B-spline4  B-spline5  B-spline6 
## 0.02578590 0.03051400 0.02063051 0.03059808 0.03774148 0.04792728</code></pre>
</div>
<div id="splineFit" class="section level2">
<h2 class="hasAnchor">
<a href="#splineFit" class="anchor"></a>Model with spline rate function</h2>
<p>When argument <code>degree</code> is specified to be a positive integer, the baseline rate function is fitted by splines. The type or flavor of the splines can be specified by argument <code>spline</code>. The available option for <code>spline</code> are <code>bSplines</code> for B-splines and <code>mSplines</code> for M-splines. (See <strong>R</strong> package <strong>spline2</strong> for details about the spline functions used internally.) A partial matching on names is allowed.</p>
<p>For example, one may want to fit the baseline rate function by a cubic spline with two internal knots. Then we may explicitly specify <code>degree = 3</code> and <code>knots</code> to be a length-two numeric vector. Or we may simply specify <code>degree = 3</code> and <code>df = 6</code> Then the internal knots will be automatically specified at suitable quantiles of the covariate representing event and censoring time. Generally speaking, the degree of freedom of spline (or the number of spline bases) equals the summation of the number of internal knots and the degree of each spline base, plus one if intercept is included in spline bases.</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1"></a><span class="co">## internal knots are set as 33% and 67% quantiles of time variable</span></span>
<span id="cb23-2"><a href="#cb23-2"></a>(splineFit &lt;-<span class="st"> </span><span class="kw"><a href="../reference/rateReg.html">rateReg</a></span>(<span class="kw"><a href="../reference/Recur.html">Recur</a></span>(time, ID, event) <span class="op">~</span><span class="st"> </span>group <span class="op">+</span><span class="st"> </span>x1, <span class="dt">data =</span> simuDat,</span>
<span id="cb23-3"><a href="#cb23-3"></a>                      <span class="dt">df =</span> <span class="dv">6</span>, <span class="dt">degree =</span> <span class="dv">3</span>, <span class="dt">spline =</span> <span class="st">"mSplines"</span>))</span></code></pre></div>
<pre><code>## Call: 
## rateReg(formula = Recur(time, ID, event) ~ group + x1, data = simuDat, 
##     df = 6, degree = 3, spline = "mSplines")
## 
## Coefficients of covariates: 
## groupTreat         x1 
## -0.6360235  0.3057244 
## 
## Frailty parameter:  0.5882684 
## 
## Internal knots: 
## 73.33333, 138
## 
## Boundary knots: 
## 0, 168
## 
## Coefficients of spline bases:
## M-spline1 M-spline2 M-spline3 M-spline4 M-spline5 M-spline6 
## 0.3431193 1.5542060 0.1478426 1.7829521 1.3690238 0.1828846</code></pre>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1"></a><span class="co">## or internal knots are expicitly specified</span></span>
<span id="cb25-2"><a href="#cb25-2"></a>(splineFit &lt;-<span class="st"> </span><span class="kw"><a href="../reference/rateReg.html">rateReg</a></span>(<span class="kw"><a href="../reference/Recur.html">Recur</a></span>(time, ID, event) <span class="op">~</span><span class="st"> </span>group <span class="op">+</span><span class="st"> </span>x1, <span class="dt">data =</span> simuDat,</span>
<span id="cb25-3"><a href="#cb25-3"></a>                      <span class="dt">spline =</span> <span class="st">"bSp"</span>, <span class="dt">degree =</span> 3L, <span class="dt">knots =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">56</span>, <span class="dv">112</span>)))</span></code></pre></div>
<pre><code>## Call: 
## rateReg(formula = Recur(time, ID, event) ~ group + x1, data = simuDat, 
##     knots = c(56, 112), degree = 3L, spline = "bSp")
## 
## Coefficients of covariates: 
## groupTreat         x1 
## -0.6352812  0.3061369 
## 
## Frailty parameter:  0.5885324 
## 
## Internal knots: 
## 56, 112
## 
## Boundary knots: 
## 0, 168
## 
## Coefficients of spline bases:
##  B-spline1  B-spline2  B-spline3  B-spline4  B-spline5  B-spline6 
## 0.01809635 0.04107572 0.01770835 0.02399031 0.06318482 0.03172925</code></pre>
</div>
<div id="summary-rateReg" class="section level2">
<h2 class="hasAnchor">
<a href="#summary-rateReg" class="anchor"></a>Summary of model fits</h2>
<p>A brief summary of the fitted model is given by <code>show()</code> method as shown in the previous examples. Further, <code><a href="https://rdrr.io/r/base/summary.html">summary()</a></code> method for <code>rateReg</code> object provides a more specific summary of the model fitted. For instance, the summary of the models fitted in section of model fitting can be called as follows:</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1"></a><span class="kw"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>(constFit)</span></code></pre></div>
<pre><code>## Call: 
## rateReg(formula = Recur(time, ID, event) ~ group + x1, data = simuDat)
## 
## Coefficients of covariates: 
##                coef exp(coef) se(coef)       z Pr(&gt;|z|)  
## groupTreat -0.60729   0.54483  0.28518 -2.1295  0.03321 *
## x1          0.32575   1.38507  0.16640  1.9576  0.05028 .
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Parameter of frailty: 
##         parameter        se
## Frailty 0.5874622 0.1101527
## 
## Boundary knots:
## 0, 168
## 
## Degree of spline bases: 0 
## 
## Coefficients of spline bases:
##               coef se(coef)
## B-spline1 0.030419   0.0057
## 
## Loglikelihood:  -1676.422</code></pre>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1"></a><span class="kw"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>(piecesFit, <span class="dt">showCall =</span> <span class="ot">FALSE</span>)</span></code></pre></div>
<pre><code>## 
## Coefficients of covariates: 
##                coef exp(coef) se(coef)       z Pr(&gt;|z|)  
## groupTreat -0.63820   0.52824  0.28515 -2.2381  0.02521 *
## x1          0.30626   1.35834  0.16699  1.8341  0.06665 .
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Parameter of frailty: 
##         parameter        se
## Frailty 0.5865717 0.1098359
## 
## Internal knots: 
## 28, 56, 84, 112, 140
## 
## Boundary knots:
## 0, 168
## 
## Degree of spline bases: 0 
## 
## Coefficients of spline bases:
##               coef se(coef)
## B-spline1 0.025786   0.0057
## B-spline2 0.030514   0.0066
## B-spline3 0.020631   0.0047
## B-spline4 0.030598   0.0066
## B-spline5 0.037741   0.0081
## B-spline6 0.047927   0.0105
## 
## Loglikelihood:  -1663.792</code></pre>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1"></a><span class="kw"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>(splineFit, <span class="dt">showCall =</span> <span class="ot">FALSE</span>, <span class="dt">showKnots =</span> <span class="ot">FALSE</span>)</span></code></pre></div>
<pre><code>## 
## Coefficients of covariates: 
##                coef exp(coef) se(coef)       z Pr(&gt;|z|)  
## groupTreat -0.63528   0.52979  0.28530 -2.2267  0.02597 *
## x1          0.30614   1.35817  0.16650  1.8386  0.06597 .
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Parameter of frailty: 
##         parameter        se
## Frailty 0.5885324 0.1103272
## 
## Degree of spline bases: 3 
## 
## Coefficients of spline bases:
##               coef se(coef)
## B-spline1 0.018096   0.0075
## B-spline2 0.041076   0.0116
## B-spline3 0.017708   0.0099
## B-spline4 0.023990   0.0108
## B-spline5 0.063185   0.0166
## B-spline6 0.031729   0.0130
## 
## Loglikelihood:  -1663.285</code></pre>
<p>The summary includes the function call, estimated covariate coefficients, estimated parameter of frailty variable, internal knots (if exist), boundary knots, degree of spline bases if splines are applied, coefficients of rate function bases (pieces), and log-likelihood of the model fitted. Outputs of function call or knots, may be suppressed by specifying argument <code>showCall</code> or <code>showKnots</code> to be <code>FALSE</code>, respectively, in <code><a href="https://rdrr.io/r/base/summary.html">summary()</a></code> method, which would be especially useful for a relatively concise summary in a reproducible report using <strong>Rmarkdown</strong>, etc.</p>
<p>What’s more, the corresponding <code><a href="https://rdrr.io/r/stats/coef.html">coef()</a></code> and <code><a href="https://rdrr.io/r/stats/confint.html">confint()</a></code> method for point estimates and confidence interval for covariate coefficients are provided as well. Let’s take the fitted model with spline rate function as an example.</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1"></a><span class="co">## point estimates of covariate coefficients</span></span>
<span id="cb33-2"><a href="#cb33-2"></a><span class="kw"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span>(splineFit)</span></code></pre></div>
<pre><code>## groupTreat         x1 
## -0.6352812  0.3061369</code></pre>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1"></a><span class="co">## confidence interval for covariate coefficients</span></span>
<span id="cb35-2"><a href="#cb35-2"></a><span class="kw"><a href="https://rdrr.io/r/stats/confint.html">confint</a></span>(splineFit, <span class="dt">level =</span> <span class="fl">0.95</span>)</span></code></pre></div>
<pre><code>##                   2.5%      97.5%
## groupTreat -1.19445835 -0.0761041
## x1         -0.02020186  0.6324757</code></pre>
</div>
<div id="model-selection" class="section level2">
<h2 class="hasAnchor">
<a href="#model-selection" class="anchor"></a>Model selection</h2>
<p>Two handy functions are provided for model selection. We may compare and select the models with different baseline rate function based on Akaike Information Criterion (AIC) by function <code><a href="https://rdrr.io/r/stats/AIC.html">AIC()</a></code> or Bayesian Information Criterion (BIC) by function <code><a href="https://rdrr.io/r/stats/AIC.html">BIC()</a></code>. A friendly warning will be thrown out if the numbers of observation were different in the model comparison by AIC.</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1"></a><span class="kw"><a href="https://rdrr.io/r/stats/AIC.html">AIC</a></span>(constFit, piecesFit, splineFit)</span></code></pre></div>
<pre><code>##           df      AIC
## constFit   4 3360.843
## piecesFit  9 3345.585
## splineFit  9 3344.570</code></pre>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1"></a><span class="kw"><a href="https://rdrr.io/r/stats/AIC.html">BIC</a></span>(constFit, piecesFit, splineFit)</span></code></pre></div>
<pre><code>##           df      BIC
## constFit   4 3377.702
## piecesFit  9 3383.516
## splineFit  9 3382.501</code></pre>
</div>
<div id="baseRate" class="section level2">
<h2 class="hasAnchor">
<a href="#baseRate" class="anchor"></a>Baseline rate function</h2>
<p>Function <code><a href="../reference/baseRate.html">baseRate()</a></code> produces <code>baseRate.rateReg</code> object representing the estimated baseline rate function for a fitter model. An associated <code><a href="https://rdrr.io/r/graphics/plot.html">plot()</a></code> method is available. For example, the baseline rate function and its confidence band estimated by cubic splines can be plotted as follows:</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1"></a>baseRateObj &lt;-<span class="st"> </span><span class="kw"><a href="../reference/baseRate.html">baseRate</a></span>(splineFit)</span>
<span id="cb41-2"><a href="#cb41-2"></a><span class="kw"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(baseRateObj, <span class="dt">conf.int =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<p><img src="reda-intro_files/figure-html/baseRate-1.png" width="672"></p>
</div>
<div id="mcf-rateReg" class="section level2">
<h2 class="hasAnchor">
<a href="#mcf-rateReg" class="anchor"></a>Estimated MCF from the fitted model</h2>
<p>If <code>rateReg</code> object is supplied to function <code><a href="../reference/mcf.html">mcf()</a></code>, the method for <code>rateReg</code> is called, which returns the estimated baseline MCF from the fitted model if <code>newdata</code> is not specified in the function. The example estimating and plotting the baseline MCF from the fitted model with piecewise constant rate function is shown as follows:</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1"></a>piecesMcf &lt;-<span class="st"> </span><span class="kw"><a href="../reference/mcf.html">mcf</a></span>(piecesFit)</span>
<span id="cb42-2"><a href="#cb42-2"></a><span class="kw"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(piecesMcf, <span class="dt">conf.int =</span> <span class="ot">TRUE</span>, <span class="dt">col =</span> <span class="st">"blueviolet"</span>) <span class="op">+</span><span class="st"> </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span>(<span class="st">"Days"</span>)</span></code></pre></div>
<p><img src="reda-intro_files/figure-html/piecesMcf-1.png" width="672"></p>
<p>The argument <code>newdata</code> allows one to estimate the MCF for a given dataset instead of the baseline MCF. If <code>newdata</code> is specified, the data frame should have the same column names as the covariate names appearing in the formula of original fitting. The MCF will be estimated for each unique row in the data frame and its confidence intervals are constructed based on Delta-method.</p>
<p>In addition, we may specify the name for grouping each unique row and the levels of each group through <code>groupName</code> and <code>groupLevels</code>, respectively. For example, we may specify <code>groupName = "Gender"</code> and <code>groupLevels = c("Male", "Female")</code> for estimation of different gender groups.</p>
<p>As the last two examples in this vignette, we estimate the MCF from fitted model with spline rate function for the different treatment groups and plot the estimated MCFs and their confidence intervals correspondingly.</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1"></a>newDat &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(<span class="dt">x1 =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">0</span>, <span class="dv">0</span>), <span class="dt">group =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"Treat"</span>, <span class="st">"Contr"</span>))</span>
<span id="cb43-2"><a href="#cb43-2"></a>estmcf &lt;-<span class="st"> </span><span class="kw"><a href="../reference/mcf.html">mcf</a></span>(splineFit, <span class="dt">newdata =</span> newDat, <span class="dt">groupName =</span> <span class="st">"Group"</span>,</span>
<span id="cb43-3"><a href="#cb43-3"></a>              <span class="dt">groupLevels =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"Treatment"</span>, <span class="st">"Control"</span>))</span>
<span id="cb43-4"><a href="#cb43-4"></a><span class="kw"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(estmcf, <span class="dt">conf.int =</span> <span class="ot">TRUE</span>, <span class="dt">col =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"royalblue"</span>, <span class="st">"red"</span>), <span class="dt">lty =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">1</span>, <span class="dv">5</span>)) <span class="op">+</span></span>
<span id="cb43-5"><a href="#cb43-5"></a><span class="st">    </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span>(<span class="st">"Control vs. Treatment"</span>) <span class="op">+</span><span class="st"> </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span>(<span class="st">"Days"</span>)</span></code></pre></div>
<p><img src="reda-intro_files/figure-html/splineMcf-1.png" width="672"></p>
<p>The data frame containing the MCF estimates is stored in the slot named <code>MCF</code>. So it is not hard to make further customization to the MCF plot.</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1"></a><span class="kw"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(estmcf) <span class="op">+</span></span>
<span id="cb44-2"><a href="#cb44-2"></a><span class="st">    </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html">geom_ribbon</a></span>(<span class="dt">data =</span> estmcf<span class="op">@</span>MCF, <span class="dt">alpha =</span> <span class="fl">0.2</span>,</span>
<span id="cb44-3"><a href="#cb44-3"></a>                <span class="kw"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="dt">x =</span> time, <span class="dt">ymin =</span> lower, <span class="dt">ymax =</span> upper, <span class="dt">fill =</span> Group)) <span class="op">+</span></span>
<span id="cb44-4"><a href="#cb44-4"></a><span class="st">    </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span>(<span class="st">"Control vs. Treatment"</span>) <span class="op">+</span><span class="st"> </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span>(<span class="st">"Days"</span>)</span></code></pre></div>
<p><img src="reda-intro_files/figure-html/plot-ribbon-1.png" width="672"></p>
</div>
</div>
<div id="reference" class="section level1 unnumbered">
<h1 class="hasAnchor">
<a href="#reference" class="anchor"></a>Reference</h1>
<div id="refs" class="references hanging-indent">
<div id="ref-cookLawless2007springer">
<p>Cook, Richard J, and Jerald Lawless. 2007. <em>The Statistical Analysis of Recurrent Events</em>. Springer Science &amp; Business Media.</p>
</div>
<div id="ref-cook1996biometrics">
<p>Cook, Richard J, Jerald F Lawless, and Claude Nadeau. 1996. “Robust Tests for Treatment Comparisons Based on Recurrent Event Responses.” <em>Biometrics</em> 52 (2): 557–71.</p>
</div>
<div id="ref-efron1979aos">
<p>Efron, B. 1979. “Bootstrap Methods: Another Look at the Jackknife.” <em>The Annals of Statistics</em> 7 (1): 1–26.</p>
</div>
<div id="ref-fu2014jbs">
<p>Fu, Haoda, Junxiang Luo, and Yongming Qu. 2016. “Hypoglycemic Events Analysis via Recurrent Time-to-Event (HEART) Models.” <em>Journal of Biopharmaceutical Statistics</em> 26 (2): 280–98.</p>
</div>
<div id="ref-lawless1995technometrics">
<p>Lawless, Jerald F, and Claude Nadeau. 1995. “Some Simple Robust Methods for the Analysis of Recurrent Events.” <em>Technometrics</em> 37 (2): 158–68.</p>
</div>
<div id="ref-lewis1979nrlq">
<p>Lewis, P A, and G S Shedler. 1979. “Simulation of Nonhomogeneous Poisson Processes by Thinning.” <em>Naval Research Logistics Quarterly</em> 26 (3): 403–13.</p>
</div>
<div id="ref-nelson1995technometrics">
<p>Nelson, Wayne B. 1995. “Confidence Limits for Recurrence Data-Applied to Cost or Number of Product Repairs.” <em>Technometrics</em> 37 (2): 147–57.</p>
</div>
<div id="ref-nelson2003siam">
<p>———. 2003. <em>Recurrent Events Data Analysis for Product Repairs, Disease Recurrences, and Other Applications</em>. Vol. 10. SIAM.</p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">

        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li>
<a href="#introduction">Introduction</a>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#simuDat">Simulated recurrent event data</a></li>
      <li><a href="#data-checking">Data checking</a></li>
      </ul>
</li>
      <li>
<a href="#exploratory-analysis">Exploratory analysis</a>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#mcf-formula">Nonparametric Mean Cumulative Function Estimates</a></li>
      <li><a href="#mcfDiff">Comparing two-sample MCFs</a></li>
      </ul>
</li>
      <li>
<a href="#rateReg">Gamma frailty model</a>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#constFit">Model with constant rate function</a></li>
      <li><a href="#piecesFit">Model with piecewise constant rate function</a></li>
      <li><a href="#splineFit">Model with spline rate function</a></li>
      <li><a href="#summary-rateReg">Summary of model fits</a></li>
      <li><a href="#model-selection">Model selection</a></li>
      <li><a href="#baseRate">Baseline rate function</a></li>
      <li><a href="#mcf-rateReg">Estimated MCF from the fitted model</a></li>
      </ul>
</li>
      <li><a href="#reference">Reference</a></li>
      </ul>
</div>
      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by Wenjie Wang, Haoda Fu.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.4.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
